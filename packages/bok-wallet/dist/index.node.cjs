"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("crypto"),t=require("ethers"),r=require("uuid"),i=require("uint8arrays"),s=require("@i3m/base-wallet");function a(e){var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}var o=a(i);class n extends s.WalletError{}class c{constructor(e,t){this.dialog=e,this.store=t}async import(e){const i=r.v4(),a=t.ethers.utils.computePublicKey(s.parseHex(e)),o={kid:i,type:"Secp256k1",publicKeyHex:s.parseHex(a,!1),privateKeyHex:s.parseHex(e,!1)},n=await this.store.get("keys");return await this.store.set("keys",{...n,[i]:o}),o}async createAccountKeyPair(){const t=e.randomBytes(32).toString("hex");return(await this.import(t)).kid}async getPublicKey(e){const r=await this.store.get("keys");if(void 0===r)throw new n("No keys initialized yet");return t.ethers.utils.arrayify(s.parseHex(r[e].publicKeyHex))}async signDigest(e,r){const i=await this.store.get("keys");if(void 0===i)throw new n("No keys initialized yet");const a=s.parseHex(i[e].privateKeyHex),c=new t.ethers.utils.SigningKey(a);if(!0!==await this.dialog.confirmation({title:"Sign?",message:`Are you sure you want to sign using key <code>${a}</code> the following hex data: \n<code>${t.ethers.utils.hexlify(r)}</code>`,acceptMsg:"Sign",rejectMsg:"Reject"}))throw new n("Signature rejected by user");const l=c.signDigest(r),u=t.ethers.utils.joinSignature(l);return o.fromString(u.substring(2),"base16")}async delete(e){return await this.store.delete(`keys.${e}`),!0}async wipe(){}}class l extends s.BaseWallet{async importDid(e){if(void 0===e&&(e=await this.dialog.form({title:"Import DID",descriptors:{alias:{type:"text",message:"Set an alias for your DID"},privateKey:{type:"text",message:"Paste the private key"}},order:["alias","privateKey"]})),void 0===e)return;const r=this.getKeyWallet(),i=await r.import(s.parseHex(e.privateKey)),a=t.ethers.utils.computePublicKey(s.parseHex(i.publicKeyHex),!0);await this.veramo.agent.didManagerImport({did:`${this.provider}:${a}`,alias:e.alias,controllerKeyId:i.kid,keys:[{...i,type:"Secp256k1",kms:this.veramo.defaultKms}],provider:this.provider,services:[]})}}exports.BokWallet=l,exports.default=async e=>{const t=new c(e.dialog,e.store);return new l({...e,keyWallet:t})};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXgubm9kZS5janMiLCJzb3VyY2VzIjpbIi4uL3NyYy90cy9lcnJvcnMudHMiLCIuLi9zcmMvdHMvYm9rLWtleS13YWxsZXQudHMiLCIuLi9zcmMvdHMvYm9rLXdhbGxldC50cyIsIi4uL3NyYy90cy9pbmRleC50cyJdLCJzb3VyY2VzQ29udGVudCI6bnVsbCwibmFtZXMiOlsiQm9rV2FsbGV0RXJyb3IiLCJXYWxsZXRFcnJvciIsIkJva0tleVdhbGxldCIsImNvbnN0cnVjdG9yIiwiZGlhbG9nIiwic3RvcmUiLCJ0aGlzIiwiYXN5bmMiLCJwcml2YXRlS2V5SGV4Iiwia2lkIiwidXVpZCIsInB1YmxpY0tleUhleCIsImV0aGVycyIsInV0aWxzIiwiY29tcHV0ZVB1YmxpY0tleSIsInBhcnNlSGV4Iiwia2V5IiwidHlwZSIsImtleXMiLCJnZXQiLCJzZXQiLCJjcnlwdG8iLCJyYW5kb21CeXRlcyIsInRvU3RyaW5nIiwiaW1wb3J0IiwidW5kZWZpbmVkIiwiYXJyYXlpZnkiLCJtZXNzYWdlRGlnZXN0Iiwic2lnbmluZ0tleSIsIlNpZ25pbmdLZXkiLCJjb25maXJtYXRpb24iLCJ0aXRsZSIsIm1lc3NhZ2UiLCJoZXhsaWZ5IiwiYWNjZXB0TXNnIiwicmVqZWN0TXNnIiwic2lnbmF0dXJlIiwic2lnbkRpZ2VzdCIsInNpZ25hdHVyZUhleCIsImpvaW5TaWduYXR1cmUiLCJ1OGEiLCJmcm9tU3RyaW5nIiwic3Vic3RyaW5nIiwiZGVsZXRlIiwiQm9rV2FsbGV0IiwiQmFzZVdhbGxldCIsImltcG9ydEluZm8iLCJmb3JtIiwiZGVzY3JpcHRvcnMiLCJhbGlhcyIsInByaXZhdGVLZXkiLCJvcmRlciIsImtleVdhbGxldCIsImdldEtleVdhbGxldCIsImNvbXByZXNzZWRQdWJsaWNLZXkiLCJ2ZXJhbW8iLCJhZ2VudCIsImRpZE1hbmFnZXJJbXBvcnQiLCJkaWQiLCJwcm92aWRlciIsImNvbnRyb2xsZXJLZXlJZCIsImttcyIsImRlZmF1bHRLbXMiLCJzZXJ2aWNl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
