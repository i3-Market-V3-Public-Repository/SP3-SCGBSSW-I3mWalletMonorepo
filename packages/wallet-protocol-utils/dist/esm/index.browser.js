import{Session as e}from"@i3m/wallet-protocol";import{BehaviorSubject as t}from"rxjs";const n=async e=>{{const t=await Promise.resolve().then((function(){return r}));return await t.pinHtmlFormDialog(e?.htmlFormDialog)}},s=n;class o{constructor(e){this.fetch=async(...e)=>{if(await this.initialized,null==this.session)throw new Error("no session");return await this.session.send(...e)},this.protocol=e.protocol,this.$session=new t(void 0),this.initialized=new Promise(((t,n)=>{this.init(e.storage).then((()=>{t(!0)})).catch((e=>{n(e)}))}))}async init(e,t){if(void 0===e){const e=(await Promise.resolve().then((function(){return l}))).SessionLocalStorage;this.storage=new e(t?.localStorage)}else this.storage=e}get hasSession(){return void 0!==this.session}async createIfNotExists(){if(await this.initialized,void 0!==this.session)return this.session;const e=await this.protocol.run();return await this.setSession(e),e}async removeSession(){await this.initialized,await this.setSession()}async setSession(e){if(await this.initialized,this.session=e,void 0===e)await this.storage.clear();else{const t=e.toJSON();await this.storage.setSessionData(JSON.stringify(t))}this.$session.next(e)}async loadSession(){let t;await this.initialized;const n=this.storage.getSessionData();null!==n&&(t=await e.fromJSON(this.protocol.transport,n)),await this.setSession(t)}}class i extends o{constructor(e,t={}){super({protocol:e,storageOptions:{localStorage:{key:t.localStorageKey}}}),this.protocol=e}}const a={overlayClass:"wallet-protocol-overlay",modalClass:"wallet-modal",titleClass:"wallet-title",messageClass:"wallet-message",inputBoxClass:"wallet-input-box",inputClass:"wallet-input",buttonClass:"wallet-button"};var r=Object.freeze({__proto__:null,pinHtmlFormDialog:async(e=a)=>{const t=Object.assign({},e,a),n=document.createElement("div");document.body.appendChild(n),n.className=t.overlayClass;const s=document.createElement("style");n.appendChild(s),s.innerText=".__WALLET_PROTOCOL_OVERLAY__ {\n    position: absolute;\n    display: flex;\n    height: 100%;\n    width: 100%;\n    top: 0;\n    left: 0;\n    align-items: center;\n    justify-content: center;\n    background-color: #000000AA;\n    font-family: 'sans-serif';\n    color: #202531;\n}\n\n.__WALLET_PROTOCOL_OVERLAY__ .__WALLET_MODAL__ {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    border: 2px solid #1A1E27;\n    border-radius: 5px;\n    padding: 10px 20px;\n    background-image: linear-gradient(to bottom left, white, #D2D6E1);\n}\n\n.__WALLET_PROTOCOL_OVERLAY__ .__WALLET_TITLE__ {\n    font-weight: bold;\n    padding: 5px;\n}\n\n.__WALLET_PROTOCOL_OVERLAY__ .__WALLET_MESSAGE__ {\n    opacity: 0.5;\n    padding: 5px;\n    font-size: 15px\n}\n\n.__WALLET_PROTOCOL_OVERLAY__ .__WALLET_INPUT_BOX__ {\n    display: flex;\n    margin: 20px;\n    height: 32px;\n}\n\n.__WALLET_PROTOCOL_OVERLAY__ .__WALLET_INPUT__ {\n    border-radius: 3px;\n    border-top-right-radius: 0;\n    border-bottom-right-radius: 0;\n    outline: none;\n    padding: 5px;\n    border: 2px solid #1A1E27;\n    border-right: none;\n}\n\n.__WALLET_PROTOCOL_OVERLAY__ .__WALLET_BUTTON__ {\n    height: 100%;\n    padding: 5px;\n    border-radius: 3px;\n    border: 2px solid #1A1E27;\n    border-top-left-radius: 0;\n    border-bottom-left-radius: 0;\n    cursor: pointer;\n}\n".replace(/__WALLET_PROTOCOL_OVERLAY__/g,t.overlayClass).replace(/__WALLET_MODAL__/g,t.modalClass).replace(/__WALLET_TITLE__/g,t.titleClass).replace(/__WALLET_MESSAGE__/g,t.messageClass).replace(/__WALLET_INPUT_BOX__/g,t.inputBoxClass).replace(/__WALLET_INPUT__/g,t.inputClass).replace(/__WALLET_BUTTON__/g,t.buttonClass);const o=document.createElement("div");n.appendChild(o),o.className=t.modalClass;const i=document.createElement("span");o.appendChild(i),i.className=t.titleClass,i.innerText="Connecting to your wallet...";const r=document.createElement("span");o.appendChild(r),r.className=t.messageClass,r.innerText="Set up your wallet on pairing mode and put the PIN here";const l=document.createElement("div");o.appendChild(l),l.className=t.inputBoxClass;const _=document.createElement("input");l.appendChild(_),_.className=t.inputClass,_.setAttribute("placeholder","pin...");const c=document.createElement("button");return l.appendChild(c),c.className=t.buttonClass,c.innerText="Syncronize",await new Promise(((e,t)=>{const s=t=>{document.body.removeChild(n),e(t??"")};c.addEventListener("click",(()=>s(_.value))),n.addEventListener("click",(e=>{e.target===n&&s()}))}))}});var l=Object.freeze({__proto__:null,SessionLocalStorage:class{constructor(e){this.key="string"==typeof e?.key&&""!==e.key?e.key:"wallet-session"}async getSessionData(){const e=localStorage.getItem(this.key);if(null==e)throw new Error("no session data stored");return JSON.parse(e)}async setSessionData(e){localStorage.setItem(this.key,JSON.stringify(e))}async clear(){localStorage.removeItem(this.key)}}});export{i as LocalSessionManager,o as SessionManager,s as openModal,n as pinDialog};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguYnJvd3Nlci5qcyIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3RzL3Bpbi1kaWFsb2cudHMiLCIuLi8uLi9zcmMvdHMvc2Vzc2lvbi1tYW5hZ2VyLnRzIiwiLi4vLi4vc3JjL3RzL3Bpbi1kaWFsb2dzL3Bpbi1odG1sZm9ybS1kaWFsb2cudHMiLCIuLi8uLi9zcmMvdHMvc2Vzc2lvbi1zdG9yYWdlcy9zZXNzaW9uLWxvY2Fsc3RvcmFnZS50cyJdLCJzb3VyY2VzQ29udGVudCI6bnVsbCwibmFtZXMiOlsicGluRGlhbG9nIiwiYXN5bmMiLCJvcHRzIiwicGluSHRtbEZvcm1EaWFsb2ciLCJQcm9taXNlIiwiaHRtbEZvcm1EaWFsb2ciLCJvcGVuTW9kYWwiLCJTZXNzaW9uTWFuYWdlciIsImNvbnN0cnVjdG9yIiwib3B0aW9ucyIsInRoaXMiLCJmZXRjaCIsImFyZ3MiLCJpbml0aWFsaXplZCIsInNlc3Npb24iLCJFcnJvciIsInNlbmQiLCJwcm90b2NvbCIsIiRzZXNzaW9uIiwiQmVoYXZpb3JTdWJqZWN0IiwidW5kZWZpbmVkIiwicmVzb2x2ZSIsInJlamVjdCIsImluaXQiLCJzdG9yYWdlIiwidGhlbiIsImNhdGNoIiwicmVhc29uIiwic3RvcmFnZU9wdGlvbnMiLCJTZXNzaW9uTG9jYWxTdG9yYWdlIiwic2Vzc2lvbkxvY2Fsc3RvcmFnZSIsImxvY2FsU3RvcmFnZSIsImhhc1Nlc3Npb24iLCJydW4iLCJzZXRTZXNzaW9uIiwiY2xlYXIiLCJzZXNzaW9uSnNvbiIsInRvSlNPTiIsInNldFNlc3Npb25EYXRhIiwiSlNPTiIsInN0cmluZ2lmeSIsIm5leHQiLCJnZXRTZXNzaW9uRGF0YSIsIlNlc3Npb24iLCJmcm9tSlNPTiIsInRyYW5zcG9ydCIsIkxvY2FsU2Vzc2lvbk1hbmFnZXIiLCJzdXBlciIsImtleSIsImxvY2FsU3RvcmFnZUtleSIsImRlZmF1bHRIdG1sT3B0aW9ucyIsIm92ZXJsYXlDbGFzcyIsIm1vZGFsQ2xhc3MiLCJ0aXRsZUNsYXNzIiwibWVzc2FnZUNsYXNzIiwiaW5wdXRCb3hDbGFzcyIsImlucHV0Q2xhc3MiLCJidXR0b25DbGFzcyIsIk9iamVjdCIsImFzc2lnbiIsIm92ZXJsYXkiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJib2R5IiwiYXBwZW5kQ2hpbGQiLCJjbGFzc05hbWUiLCJzdHlsZSIsImlubmVyVGV4dCIsInJlcGxhY2UiLCJtb2RhbCIsInRpdGxlIiwibWVzc2FnZSIsImlucHV0Qm94IiwicGluSW5wdXQiLCJzZXRBdHRyaWJ1dGUiLCJwYWlyQnV0dG9uIiwiY2xvc2UiLCJ2YWx1ZSIsInJlbW92ZUNoaWxkIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2IiwidGFyZ2V0IiwiaXRlbSIsImdldEl0ZW0iLCJwYXJzZSIsImpzb24iLCJzZXRJdGVtIiwicmVtb3ZlSXRlbSJdLCJtYXBwaW5ncyI6IjRGQU9hQSxFQUFZQyxNQUFPQyxJQUNkLENBQ2QsTUFBTUMsUUFBMEJDLCtDQUNoQyxhQUFhRCxFQUFrQkEsa0JBQWtCRCxHQUFNRyxlQUl4RCxHQVNVQyxFQUFZTixRQ2hCWk8sRUFPWEMsWUFBYUMsR0E0QmJDLEtBQUFDLE1BQTRCVixTQUFVVyxLQUdwQyxTQUZNRixLQUFLRyxZQUVTLE1BQWhCSCxLQUFLSSxRQUNQLE1BQU0sSUFBSUMsTUFBTSxjQUdsQixhQUFhTCxLQUFLSSxRQUFRRSxRQUFRSixFQUFLLEVBbEN2Q0YsS0FBS08sU0FBV1IsRUFBUVEsU0FDeEJQLEtBQUtRLFNBQVcsSUFBSUMsT0FBd0NDLEdBQzVEVixLQUFLRyxZQUFjLElBQUlULFNBQVEsQ0FBQ2lCLEVBQVNDLEtBQ3ZDWixLQUFLYSxLQUFLZCxFQUFRZSxTQUFTQyxNQUFLLEtBQzlCSixHQUFRLEVBQUssSUFDWkssT0FBTUMsSUFBWUwsRUFBT0ssRUFBTyxHQUFHLEdBRXpDLENBRU8xQixXQUFZdUIsRUFBMEJJLEdBQzVDLFFBQWdCUixJQUFaSSxFQUNjLENBQ2QsTUFBTUssU0FBNkJ6QixRQUFpRGlCLFVBQUFJLE1BQUEsV0FBQSxPQUFBSyxD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
