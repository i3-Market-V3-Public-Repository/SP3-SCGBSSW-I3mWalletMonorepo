import{Session as e}from"@i3m/wallet-protocol";import{BehaviorSubject as t}from"rxjs";const n=async e=>{{const t=await Promise.resolve().then((function(){return r}));return await t.pinHtmlFormDialog(e?.htmlFormDialog)}},s=n;class o{constructor(e){this.fetch=async(...e)=>{if(await this.initialized,null==this.session)throw new Error("no session");return await this.session.send(...e)},this.protocol=e.protocol,this.$session=new t(void 0),this.initialized=new Promise(((t,n)=>{this.init(e.storage).then((()=>{t(!0)})).catch((e=>{n(e)}))}))}async init(e,t){if(void 0===e){const e=(await Promise.resolve().then((function(){return l}))).SessionLocalStorage;this.storage=new e(t?.localStorage)}else this.storage=e}get hasSession(){return void 0!==this.session}async createIfNotExists(){if(await this.initialized,void 0!==this.session)return this.session;const e=await this.protocol.run();return await this.setSession(e),e}async removeSession(){await this.initialized,await this.setSession()}async setSession(e){if(await this.initialized,this.session=e,null==e)await this.storage.clear();else{const t=e.toJSON();await this.storage.setSessionData(JSON.stringify(t))}this.$session.next(e)}async loadSession(){let t;await this.initialized;try{const n=await this.storage.getSessionData();null!==n&&(t=await e.fromJSON(this.protocol.transport,n))}catch(e){}await this.setSession(t)}}class a extends o{constructor(e,t={}){super({protocol:e,storageOptions:{localStorage:{key:t.localStorageKey}}}),this.protocol=e}}const i={overlayClass:"wallet-protocol-overlay",modalClass:"wallet-modal",titleClass:"wallet-title",messageClass:"wallet-message",inputBoxClass:"wallet-input-box",inputClass:"wallet-input",buttonClass:"wallet-button"};var r=Object.freeze({__proto__:null,pinHtmlFormDialog:async(e=i)=>{const t=Object.assign({},e,i),n=document.createElement("div");document.body.appendChild(n),n.className=t.overlayClass;const s=document.createElement("style");n.appendChild(s),s.innerText=".__WALLET_PROTOCOL_OVERLAY__ {\n    position: absolute;\n    display: flex;\n    height: 100%;\n    width: 100%;\n    top: 0;\n    left: 0;\n    align-items: center;\n    justify-content: center;\n    background-color: #000000AA;\n    font-family: 'sans-serif';\n    color: #202531;\n}\n\n.__WALLET_PROTOCOL_OVERLAY__ .__WALLET_MODAL__ {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    border: 2px solid #1A1E27;\n    border-radius: 5px;\n    padding: 10px 20px;\n    background-image: linear-gradient(to bottom left, white, #D2D6E1);\n}\n\n.__WALLET_PROTOCOL_OVERLAY__ .__WALLET_TITLE__ {\n    font-weight: bold;\n    padding: 5px;\n}\n\n.__WALLET_PROTOCOL_OVERLAY__ .__WALLET_MESSAGE__ {\n    opacity: 0.5;\n    padding: 5px;\n    font-size: 15px\n}\n\n.__WALLET_PROTOCOL_OVERLAY__ .__WALLET_INPUT_BOX__ {\n    display: flex;\n    margin: 20px;\n    height: 32px;\n}\n\n.__WALLET_PROTOCOL_OVERLAY__ .__WALLET_INPUT__ {\n    border-radius: 3px;\n    border-top-right-radius: 0;\n    border-bottom-right-radius: 0;\n    outline: none;\n    padding: 5px;\n    border: 2px solid #1A1E27;\n    border-right: none;\n}\n\n.__WALLET_PROTOCOL_OVERLAY__ .__WALLET_BUTTON__ {\n    height: 100%;\n    padding: 5px;\n    border-radius: 3px;\n    border: 2px solid #1A1E27;\n    border-top-left-radius: 0;\n    border-bottom-left-radius: 0;\n    cursor: pointer;\n}\n".replace(/__WALLET_PROTOCOL_OVERLAY__/g,t.overlayClass).replace(/__WALLET_MODAL__/g,t.modalClass).replace(/__WALLET_TITLE__/g,t.titleClass).replace(/__WALLET_MESSAGE__/g,t.messageClass).replace(/__WALLET_INPUT_BOX__/g,t.inputBoxClass).replace(/__WALLET_INPUT__/g,t.inputClass).replace(/__WALLET_BUTTON__/g,t.buttonClass);const o=document.createElement("div");n.appendChild(o),o.className=t.modalClass;const a=document.createElement("span");o.appendChild(a),a.className=t.titleClass,a.innerText="Connecting to your wallet...";const r=document.createElement("span");o.appendChild(r),r.className=t.messageClass,r.innerText="Set up your wallet on pairing mode and put the PIN here";const l=document.createElement("div");o.appendChild(l),l.className=t.inputBoxClass;const c=document.createElement("input");l.appendChild(c),c.className=t.inputClass,c.setAttribute("placeholder","pin...");const _=document.createElement("button");return l.appendChild(_),_.className=t.buttonClass,_.innerText="Syncronize",await new Promise(((e,t)=>{const s=t=>{document.body.removeChild(n),e(t??"")};_.addEventListener("click",(()=>s(c.value))),n.addEventListener("click",(e=>{e.target===n&&s()}))}))}});var l=Object.freeze({__proto__:null,SessionLocalStorage:class{constructor(e){this.key="string"==typeof e?.key&&""!==e.key?e.key:"wallet-session"}async getSessionData(){const e=localStorage.getItem(this.key);if(null==e)throw new Error("no session data stored");return JSON.parse(e)}async setSessionData(e){localStorage.setItem(this.key,JSON.stringify(e))}async clear(){localStorage.removeItem(this.key)}}});export{a as LocalSessionManager,o as SessionManager,s as openModal,n as pinDialog};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguYnJvd3Nlci5qcyIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3RzL3Bpbi1kaWFsb2cudHMiLCIuLi8uLi9zcmMvdHMvc2Vzc2lvbi1tYW5hZ2VyLnRzIiwiLi4vLi4vc3JjL3RzL3Bpbi1kaWFsb2dzL3Bpbi1odG1sZm9ybS1kaWFsb2cudHMiLCIuLi8uLi9zcmMvdHMvc2Vzc2lvbi1zdG9yYWdlcy9zZXNzaW9uLWxvY2Fsc3RvcmFnZS50cyJdLCJzb3VyY2VzQ29udGVudCI6bnVsbCwibmFtZXMiOlsicGluRGlhbG9nIiwiYXN5bmMiLCJvcHRzIiwicGluSHRtbEZvcm1EaWFsb2ciLCJQcm9taXNlIiwiaHRtbEZvcm1EaWFsb2ciLCJvcGVuTW9kYWwiLCJTZXNzaW9uTWFuYWdlciIsImNvbnN0cnVjdG9yIiwib3B0aW9ucyIsInRoaXMiLCJmZXRjaCIsImFyZ3MiLCJpbml0aWFsaXplZCIsInNlc3Npb24iLCJFcnJvciIsInNlbmQiLCJwcm90b2NvbCIsIiRzZXNzaW9uIiwiQmVoYXZpb3JTdWJqZWN0IiwidW5kZWZpbmVkIiwicmVzb2x2ZSIsInJlamVjdCIsImluaXQiLCJzdG9yYWdlIiwidGhlbiIsImNhdGNoIiwicmVhc29uIiwic3RvcmFnZU9wdGlvbnMiLCJTZXNzaW9uTG9jYWxTdG9yYWdlIiwic2Vzc2lvbkxvY2Fsc3RvcmFnZSIsImxvY2FsU3RvcmFnZSIsImhhc1Nlc3Npb24iLCJydW4iLCJzZXRTZXNzaW9uIiwiY2xlYXIiLCJzZXNzaW9uSnNvbiIsInRvSlNPTiIsInNldFNlc3Npb25EYXRhIiwiSlNPTiIsInN0cmluZ2lmeSIsIm5leHQiLCJnZXRTZXNzaW9uRGF0YSIsIlNlc3Npb24iLCJmcm9tSlNPTiIsInRyYW5zcG9ydCIsImVycm9yIiwiTG9jYWxTZXNzaW9uTWFuYWdlciIsInN1cGVyIiwia2V5IiwibG9jYWxTdG9yYWdlS2V5IiwiZGVmYXVsdEh0bWxPcHRpb25zIiwib3ZlcmxheUNsYXNzIiwibW9kYWxDbGFzcyIsInRpdGxlQ2xhc3MiLCJtZXNzYWdlQ2xhc3MiLCJpbnB1dEJveENsYXNzIiwiaW5wdXRDbGFzcyIsImJ1dHRvbkNsYXNzIiwiT2JqZWN0IiwiYXNzaWduIiwib3ZlcmxheSIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImJvZHkiLCJhcHBlbmRDaGlsZCIsImNsYXNzTmFtZSIsInN0eWxlIiwiaW5uZXJUZXh0IiwicmVwbGFjZSIsIm1vZGFsIiwidGl0bGUiLCJtZXNzYWdlIiwiaW5wdXRCb3giLCJwaW5JbnB1dCIsInNldEF0dHJpYnV0ZSIsInBhaXJCdXR0b24iLCJjbG9zZSIsInZhbHVlIiwicmVtb3ZlQ2hpbGQiLCJhZGRFdmVudExpc3RlbmVyIiwiZXYiLCJ0YXJnZXQiLCJpdGVtIiwiZ2V0SXRlbSIsInBhcnNlIiwianNvbiIsInNldEl0ZW0iLCJyZW1vdmVJdGVtIl0sIm1hcHBpbmdzIjoiNEZBT2FBLEVBQVlDLE1BQU9DLElBQ2QsQ0FDZCxNQUFNQyxRQUEwQkMsK0NBQ2hDLGFBQWFELEVBQWtCQSxrQkFBa0JELEdBQU1HLGVBSXhELEdBU1VDLEVBQVlOLFFDaEJaTyxFQU9YQyxZQUFhQyxHQTRCYkMsS0FBQUMsTUFBNEJWLFNBQVVXLEtBR3BDLFNBRk1GLEtBQUtHLFlBRVMsTUFBaEJILEtBQUtJLFFBQ1AsTUFBTSxJQUFJQyxNQUFNLGNBR2xCLGFBQWFMLEtBQUtJLFFBQVFFLFFBQVFKLEVBQUssRUFsQ3ZDRixLQUFLTyxTQUFXUixFQUFRUSxTQUN4QlAsS0FBS1EsU0FBVyxJQUFJQyxPQUF3Q0MsR0FDNURWLEtBQUtHLFlBQWMsSUFBSVQsU0FBUSxDQUFDaUIsRUFBU0MsS0FDdkNaLEtBQUthLEtBQUtkLEVBQVFlLFNBQVNDLE1BQUssS0FDOUJKLEdBQVEsRUFBSyxJQUNaSyxPQUFNQyxJQUFZTCxFQUFPSyxFQUFPLEdBQUcsR0FFekMsQ0FFTzFCLFdBQVl1QixFQUEwQkksR0FDNUMsUUFBZ0JSLElBQVpJLEVBQ2MsQ0FDZCxNQUFNSyxTQUE2QnpCLFFBQWlEaUIsVUFBQUksTUFBQSxXQUFB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
